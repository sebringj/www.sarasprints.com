{% extends 'layout.html' %}

{% block head %}

{% endblock %}

{% block content %}
<div class="modal" data-signin role="dialog" tabindex="-1" style="display:none">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
		  <form>
	          <input type="email" required class="email" placeholder="email" />
	          <input type="password" required class="password" placeholder="password" />
	          <div class="alert alert-error" style="display:none;">
	              <button type="button" class="close">×</button>
	              <span class="message">Credentials are invalid</span>
	          </div>
	  	  </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button>	 
      </div>
    </div>
  </div>
</div>

<div class="modal" data-resetpassword role="dialog" tabindex="-1" style="display:none">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title"></h4>
      </div>
      <div class="modal-body">
		  <form>
	          <input type="email" required class="email" placeholder="email" />
	          <div class="alert alert-error" style="display:none;">
	              <button type="button" class="close">×</button>
	              <span class="message">Could not find email address</span>
	          </div>
	          <div class="alert alert-success" style="display:none;">
	              <button type="button" class="close">×</button>
	              <span class="message">Check your email for your new password</span>
	          </div>
	  	  </form>
      </div>
      <div class="modal-footer">
          <button type="button" class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
          <button type="submit" class="btn btn-primary">Submit</button>	  
	  </div>
    </div>
  </div>
</div>

<div class="container">
    <div class="loggedout">
        <h1>My Account</h1>
        <p><a href="/account">Sign in</a> to access your account.</p>
    </div>
    <div id="accountContent" class="loggedin"></div>
</div>

{% endblock %}

{% block foot %}
{% raw %}
<script id="accountTemplate" type="template">
    <h1>Welcome, [%=userInfo.firstName%]</h1>
    <ul class="nav nav-tabs" id="accountTabs">
        <li class="active"><a href="#promotions">Shop Promotions</a></li>
        <li><a href="#history">Purchase History</a></li>
        <li><a href="#password">Change Password</a></li>
    </ul>

    <div class="tab-content">
        <div class="tab-pane active" id="promotions">
            [% if (!userInfo.availablePromotions || userInfo.availablePromotions.length === 0) { %]
                <div>There are no promotions assigned to your account.</div>
            [% } else {%]
                [% for(var i = 0; i < userInfo.availablePromotions.length; i++) { %]
                   <a href="#" data-promotion="[%=userInfo.availablePromotions[i].promotionCode%]">[%=userInfo.availablePromotions[i].promotionName%]</a><br />
                [% } %]
            [% } %]
        </div>
        <div class="tab-pane" id="history">
            [% if (!userInfo.myOrders || userInfo.myOrders.length === 0) { %]
                <div>You have no purchase history.</div>
            [% } else { %]
            <table class="order-history table">
                <tr>
                    <th>Order Date</th>
                    <th>Programs</th>
                    <th>Order #</th>
                    <th>Status</th>
                    <th>Date Shipped</th>
                </tr>
                [% for(var i = 0; i < userInfo.myOrders.length; i++) { 
                    var myOrder = userInfo.myOrders[i];
                %]
                    <tr class="quick-info">
                        <td>[%=myOrder.orderDate%]</td>
                        <td>[%=myOrder.promotionName%]</td>
                        <td>[%=myOrder.orderNumber%]</td>
                        <td>[%=myOrder.orderStatusDesc%]</td>
                        <td>[%=myOrder.shippedDate%]</td>
                    </tr>
                    <tr class="detail">
                        <td colspan="5">
                            <div class="slide">
                                <table class="order-table" cellspacing="0" cellpadding="0" border="0">
                                    <caption>Purchased Items</caption>
                                    [% for(j = 0; j < myOrder.items.length; j++) { 
                                        var item = myOrder.items[j];
                                    %]
                                    <tr>
                                        <td><div class="img"><img src="[%=item.itemImage%]" /></div></td>
                                        <td>[%=item.itemSize%] [%=item.itemColor%]</td>
                                        <td>[%=item.itemName%] [%=item.itemQuantity%]</td>
                                        <td>[%=item.itemNumber%]</td>
                                        <td>[%=item.itemTotalPrice.toFixed(2)%]</td>
                                    </tr>
                                    [% } %]
                                    <tr>
                                        <td colspan="4" align="right">w/ tax &amp; shipping &nbsp;</td>
                                        <td><b>[%=myOrder.totalOrderedAmount.toFixed(2)%]</b> total</td>
                                    </tr>
                                </table>
                                <table class="order-detail" cellspacing="0" cellpadding="0" border="0" width="100%">
                                    <caption class="header">Order Detail</caption>
                                    <tr>
                                        <td valign="top">
                                            <b>Shipped To:</b><br />
                                            [%=myOrder.shipToAttention%]<br />
                                            [%=myOrder.shipToStreet%]<br />
                                            [%=myOrder.shipToCity%], [%=myOrder.shipToState%] [%=myOrder.shipToZip%]
                                        </td>
                                        <td valign="top">
                                            <b>Tracking Information</b><br />
                                            Shipped: [%=myOrder.shippingMethodCode%]<br />
                                            Tracking: [%=emeraldcode.trackingDisplay(myOrder.shippingMethodCode,myOrder.trackingNumber)%]                
                                        </td>
                                        <td valign="top">
                                            <b>Billed To:</b><br />
                                            zip code $[%=myOrder.billToZip%]
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </td>
                    </tr>
                [% } %]
            </table>
            [% } %]
        </div>
        <div class="tab-pane" id="password">
            <form action="#" method="post" id="changePasswordForm">
                <div>
                    <input type="password" required name="oldPassword" placeholder="old password"><br />
                    <input type="password" required name="newPassword" placeholder="new password"><br />
                    <button type="submit" class="btn btn-success">Change Password</button>
                    <div class="inline">
                        <div class="alert alert-error" style="display:none;">
                            <button type="button" class="close">×</button>
                            <span class="message"></span>
                        </div>
                        <div class="alert alert-success " style="display:none;">
                            <button type="button" class="close">×</button>
                            <span class="message"></span>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</script>
{% endraw %}
<script src="//api.emeraldcode.com/js/plugins/ejs.js"></script>
<script src="/js/pages/account.js"></script>

{% endblock %}